<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Tetris Valentine ğŸ’˜</title>
<style>
/* GLOBAL */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ff4e8b, #ff9a9e);
    color: white;
    text-align: center;
    overflow: hidden;
}

/* GAME SCREEN */
#tetris-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
}

#tetris {
    background: #000;
    width: 200px;
    height: 400px;
    position: relative;
    margin-bottom: 10px;
}

/* VALENTINE SCREEN */
.container {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 30px;
    box-sizing: border-box;
    position: relative;
}

button {
    font-size: 4vw;
    padding: 3vw 5vw;
    margin: 8px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    transform: scale(1.05);
    background: #ff69b4;
}

.yes-btn {
    background: #fff;
    color: #ff4e8b;
}

.no-btn, .maybe-btn {
    background: #ff2e63;
    color: white;
    position: absolute;
}

.hidden {
    display: none !important;
}

.confetti {
    width: 10px;
    height: 10px;
    position: fixed;
    top: -10px;
    animation: fall 3s linear infinite;
}

@keyframes fall {
    to { transform: translateY(100vh) rotate(360deg); }
}

/* COUNTDOWN */
#countdown {
    font-size: 8vw;
    margin: 20px;
}
</style>
</head>

<body>

<!-- TETRIS SCREEN -->
<div id="tetris-screen">
    <h1>ğŸ® Tetris Valentine ğŸ’˜</h1>
    <div id="tetris"></div>
    <div>
        <button onclick="movePiece(-1)">â—€ï¸</button>
        <button onclick="rotatePiece()">ğŸ”„</button>
        <button onclick="movePiece(1)">â–¶ï¸</button>
        <button onclick="dropPiece()">â¬‡ï¸</button>
    </div>
    <p>Use buttons to play! When the game ends, the Valentine question appears.</p>
</div>

<!-- FINAL VALENTINE SCREEN -->
<div class="container hidden" id="final">
    <h1>Will You Be My Valentine? ğŸ’˜</h1>
    <div id="countdown">5</div>
    <button class="yes-btn" onclick="celebrate()">YES ğŸ’–</button>
    <button class="no-btn" id="noBtn">no ğŸ™„</button>
    <button class="maybe-btn" id="maybeBtn">maybe ğŸ¤”</button>
</div>

<!-- CELEBRATION -->
<div class="container hidden" id="celebration">
    <h1>ğŸ‰ CONGRATULATIONS ğŸ‰</h1>
    <h2>You are now officially stuck with me ğŸ˜ŒğŸ’</h2>
    <h2 id="extraMessage" style="margin-top:20px;"></h2>
</div>

<script>
// ------------------ SIMPLE TETRIS ------------------
const COLS = 10, ROWS = 20;
let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
let currentPiece, gameInterval;

// PIECES
const SHAPES = [
    [[1,1,1],[0,1,0]],
    [[2,2],[2,2]],
    [[0,3,3],[3,3,0]],
    [[4,4,0],[0,4,4]],
    [[5,5,5,5]]
];

// White color for all blocks
const COLOR = "#fff";

function randomPiece() {
    let shape = SHAPES[Math.floor(Math.random()*SHAPES.length)];
    return { shape, x: 3, y: 0 };
}

function draw() {
    const div = document.getElementById("tetris");
    div.innerHTML = "";
    board.forEach((row, r) => {
        row.forEach((cell, c) => {
            if(cell) {
                let block = document.createElement("div");
                block.style.position="absolute";
                block.style.width="20px";
                block.style.height="20px";
                block.style.background=COLOR;
                block.style.left=(c*20)+"px";
                block.style.top=(r*20)+"px";
                div.appendChild(block);
            }
        });
    });
    if(currentPiece) {
        currentPiece.shape.forEach((row, r) =>
            row.forEach((v, c) => {
                if(v) {
                    let block = document.createElement("div");
                    block.style.position="absolute";
                    block.style.width="20px";
                    block.style.height="20px";
                    block.style.background=COLOR;
                    block.style.left=((currentPiece.x+c)*20)+"px";
                    block.style.top=((currentPiece.y+r)*20)+"px";
                    div.appendChild(block);
                }
            })
        );
    }
}

function collide(x, y, shape) {
    return shape.some((row, r) => 
        row.some((v, c) => 
            v && (
                currentPiece.y + y + r >= ROWS ||
                currentPiece.x + x + c < 0 ||
                currentPiece.x + x + c >= COLS ||
                board[currentPiece.y + y + r][currentPiece.x + c]
            )
        )
    );
}

function merge() {
    currentPiece.shape.forEach((row, r) =>
        row.forEach((v, c) => {
            if(v) board[currentPiece.y+r][currentPiece.x+c] = v;
        })
    );
}

function rotatePiece() {
    let rotated = currentPiece.shape[0].map((col, i) => 
        currentPiece.shape.map(row => row[i]).reverse()
    );
    if(!collide(0,0,rotated)) currentPiece.shape = rotated;
    draw();
}

function movePiece(dir) {
    if(!collide(dir,0,currentPiece.shape)) currentPiece.x += dir;
    draw();
}

function dropPiece() {
    if(!collide(0,1,currentPiece.shape)) {
        currentPiece.y++;
    } else {
        merge();
        clearLines();
        currentPiece = randomPiece();
        if(collide(0,0,currentPiece.shape)) gameOver();
    }
    draw();
}

function clearLines() {
    board = board.filter(row => row.some(v => v===0));
    while(board.length<ROWS) board.unshift(Array(COLS).fill(0));
}

function gameOver() {
    clearInterval(gameInterval);
    setTimeout(endTetris, 300);
}

function tetrisLoop() {
    dropPiece();
}

function startTetrisGame() {
    currentPiece = randomPiece();
    draw();
    gameInterval = setInterval(tetrisLoop, 600);
}

function endTetris() {
    document.getElementById("tetris-screen").classList.add("hidden");
    document.getElementById("final").classList.remove("hidden");
    startCountdown();
    moveNoMaybeButtons();
}

startTetrisGame();

// ------------------ FINAL VALENTINE ------------------
let buttonsActive = true;
let countdownInterval;

function startCountdown() {
    let counter = 5;
    const countdown = document.getElementById("countdown");
    countdownInterval = setInterval(() => {
        counter--;
        countdown.innerText = counter;
        if(counter<=0) {
            clearInterval(countdownInterval);
            countdown.innerText = "Time's up! Click YES ğŸ˜";
        }
    },1000);
}

function moveNoMaybeButtons() {
    const noBtn = document.getElementById("noBtn");
    const maybeBtn = document.getElementById("maybeBtn");
    [noBtn, maybeBtn].forEach(btn => {
        const dodge = (e) => {
            if(!buttonsActive) return;
            e.preventDefault(); e.stopPropagation();
            const x = Math.random()*(window.innerWidth-btn.offsetWidth);
            const y = Math.random()*(window.innerHeight-btn.offsetHeight);
            btn.style.left=x+"px"; btn.style.top=y+"px";
        };
        btn.addEventListener("pointerdown", dodge);
    });
}

function celebrate() {
    buttonsActive=false;
    document.getElementById("final").classList.add("hidden");
    document.getElementById("celebration").classList.remove("hidden");

    // Confetti
    for (let i=0; i<100; i++){
        let c=document.createElement("div");
        c.className="confetti";
        c.style.background=["#fff","#ff2e63","#ffd700","#00f5d4"][Math.floor(Math.random()*4)];
        c.style.left=Math.random()*100+"vw";
        document.body.appendChild(c);
    }

    // Extra message
    document.getElementById("extraMessage").innerText = "See you tomorrow at 7pm ğŸ’–";
}
</script>
</body>
</html>
